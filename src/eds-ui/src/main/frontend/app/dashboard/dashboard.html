<!DOCTYPE html>
<div class="module">
	<div class="module-heading">
		Data Service Dashboard
		<button class="btn btn-success btn-sm pull-right" type="button" ng-click="dashboard.refresh()">Refresh</button>
	</div>
	<div class="module-body">
		<div class="container-fluid">
			<div class="row">
				<div class="col-md-12">
					<div class="panel panel-primary">
						<div class="panel-heading">Recent Items <span class="fa fa-sm fa-refresh fa-refresh-animate" ng-hide="dashboard.recentDocumentsData"></span></div>
						<div class="panel-body">
							<div class="table">
								<table class="table table-striped table-condensed">
									<thead>
										<tr>
											<th>Name</th>
											<th>Modified</th>
											<th>Type</th>
										</tr>
									</thead>
									<tbody>
										<tr ng-repeat="item in dashboard.recentDocumentsData">
											<td>
												<a style="cursor:pointer" ng-click="dashboard.actionItem(item,'edit')">{{item.name}}</a>
												<span class="fa fa-info-circle fa-right-pad text-muted" uib-tooltip="{{item.description}}" ng-show="item.description"></span>
											</td>
											<td>{{item.lastModified | date:'dd-MMM-yyyy HH:mm:ss'}}</td>
											<td><span class="fa fa-right-pad {{item.type | itemTypeIdToIcon}} text-muted"></span>{{item.type | itemTypeIdToString }}</td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>

			<div class="row">
				<div class="col-md-12">
					<div class="panel panel-primary">
						<div class="panel-heading">Rabbit Status <span class="fa fa-sm fa-refresh fa-refresh-animate" ng-hide="dashboard.rabbitNodes"></span></div>
						<div class="panel-body" style="overflow:hidden; height:100%;">
								<div class="row">
									<div class="col-md-offset-1 col-md-11">
										<label class="control-label">Node status</label>
										<div>
											<span ng-repeat="item in dashboard.rabbitNodes">
												<span class="label"
															ng-class="dashboard.getPingLabelClass(item)">
													{{ item.address }}
														<span ng-show="item.ping == -1">(down)</span>
														<span ng-show="item.ping == 0">(...)</span>
														<span ng-show="item.ping > 0">({{item.ping}} ms)</span>
												</span>&nbsp;
											</span>
										</div>
									</div>
								</div>
								<div class="row">
									<div class="col-md-offset-1 col-md-2">
										<label class="control-label">Inbound Exchange</label>
										<div ng-repeat="exchange in [dashboard.inboundExchange]">
											<div ng-include src="'exchangeTemplate'"></div>
										</div>

										<label class="control-label">Inbound Queues</label>
										<div ng-repeat="item in dashboard.inboundQueues">
											<div ng-include src="'queueTemplate'"></div>
										</div>
									</div>

									<div class="col-md-2">
										<label class="control-label">Response Exchange</label>
										<div ng-repeat="exchange in [dashboard.responseExchange]">
											<div ng-include src="'exchangeTemplate'"></div>
										</div>

										<label class="control-label">Response Queues</label>
										<div ng-repeat="item in dashboard.responseQueues">
											<div ng-include src="'queueTemplate'"></div>
										</div>
									</div>

									<div class="col-md-2">
										<label class="control-label">Protocol Exchange</label>
										<div ng-repeat="exchange in [dashboard.protocolExchange]">
											<div ng-include src="'exchangeTemplate'"></div>
										</div>

										<label class="control-label">Protocol Queues</label>
										<div ng-repeat="item in dashboard.protocolQueues">
											<div ng-include src="'queueTemplate'"></div>
										</div>
									</div>

									<div class="col-md-2">
										<label class="control-label">Transform Exchange</label>
										<div ng-repeat="exchange in [dashboard.transformExchange]">
											<div ng-include src="'exchangeTemplate'"></div>
										</div>

										<label class="control-label">Transform Queues</label>
										<div ng-repeat="item in dashboard.transformQueues">
											<div ng-include src="'queueTemplate'"></div>
										</div>
									</div>

									<div class="col-md-2">
										<label class="control-label">Subscriber Exchange</label>
										<div ng-repeat="exchange in [dashboard.subscriberExchange]">
											<div ng-include src="'exchangeTemplate'"></div>
										</div>

										<label class="control-label">Subscriber Queues</label>
										<div ng-repeat="item in dashboard.subscriberQueues">
											<div ng-include src="'queueTemplate'"></div>
										</div>
									</div>
								</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script type="text/ng-template" id="exchangeTemplate">
	<div class="progress">
		<div class="small">{{exchange.name}} ({{exchange.message_stats.publish_in_details.rate}}/s)</div>
		<div class="progress-bar"
				 role="progressbar"
				 aria-valuemin="0"
				 aria-valuemax="{{dashboard.exchangeRateMax}}"
				 aria-valuenow="{{exchange.message_stats.publish_in_details.rate}}"
				 ng-style="dashboard.getExchangeRateAsWidthStylePercent(exchange)">
		</div>
	</div>
</script>

<script type="text/ng-template" id="queueTemplate">
	<div class="progress">
		<div class="small">{{dashboard.getName(item.name)}} ({{item.messages_ready}} @ {{item.message_stats.publish_details.rate}}/s)</div>
		<div class="progress-bar progress-bar-success"
				 role="progressbar"
				 aria-valuemin="0"
				 aria-valuenow="{{item.publish_details.rate}}"
				 aria-valuemax="{{dashboard.queueRateMax}}"
				 ng-style="dashboard.getQueueRateAsWidthStylePercent(item)">
		</div>
	</div>
</script>
